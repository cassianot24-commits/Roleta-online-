<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Roleta Online</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body { background:#111; color:#fff; font-family:Arial; text-align:center }
.box { background:#1e1e1e; padding:20px; margin:20px auto; width:320px; border-radius:10px }
input, select, button { width:90%; padding:10px; margin:5px }
button { cursor:pointer }

.roleta {
  width:200px; height:200px;
  border-radius:50%;
  border:10px solid #444;
  margin:20px auto;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:40px;
  transition: transform 3s ease-out;
  background:conic-gradient(
    red, orange, yellow, green, cyan,
    blue, purple, pink, lime, gold
  );
}
</style>
</head>

<body>

<div class="box" id="loginBox">
  <h2>Login</h2>
  <input id="nome" placeholder="Nome">
  <input id="senha" type="password" placeholder="Senha">
  <select id="tipo">
    <option value="user">UsuÃ¡rio</option>
    <option value="admin">Dono</option>
  </select>
  <button onclick="login()">Entrar</button>
</div>

<div class="box" id="userBox" style="display:none">
  <h2>UsuÃ¡rio</h2>
  <button onclick="pedirAcesso()">Pedir acesso</button>
  <div class="roleta" id="roleta">ðŸŽ¡</div>
  <button id="btnRolar" onclick="rolar()" disabled>Girar Roleta</button>
  <p id="resultado"></p>
</div>

<div class="box" id="adminBox" style="display:none">
  <h2>Dono</h2>

  <h3>Pedidos</h3>
  <div id="pedidos"></div>

  <h3>Resultados</h3>
  <div id="resultados"></div>
</div>

<script>
// ðŸ”¥ FIREBASE CONFIG
const firebaseConfig = {
  apiKey: "SUA_API_KEY",
  authDomain: "SEU_DOMINIO",
  projectId: "SEU_PROJECT_ID"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let usuario = "";
let rotacao = 0;

/* LOGIN */
function login(){
  const n = nome.value.trim();
  const s = senha.value.trim();
  const t = tipo.value;

  if(!n || !s) return alert("Preencha tudo");
  if(s !== "RC1") return alert("Senha errada");

  usuario = n;
  loginBox.style.display = "none";

  if(t === "admin"){
    adminBox.style.display = "block";
    ouvirPedidos();
    ouvirResultados();
  } else {
    userBox.style.display = "block";
    verificarAprovacao();
  }
}

/* USUÃRIO */
function pedirAcesso(){
  db.collection("pedidos").doc(usuario).set({
    aprovado:false
  });
  alert("Pedido enviado ao dono");
}

function verificarAprovacao(){
  db.collection("pedidos").doc(usuario)
    .onSnapshot(doc=>{
      if(doc.exists && doc.data().aprovado){
        btnRolar.disabled = false;
      }
    });
}

function rolar(){
  const num = Math.floor(Math.random()*10)+1;
  rotacao += 720 + num * 36;
  roleta.style.transform = `rotate(${rotacao}deg)`;

  setTimeout(()=>{
    resultado.innerText = "VocÃª tirou: " + num;
    db.collection("resultados").add({
      nome:usuario,
      numero:num,
      data:new Date()
    });
  }, 3000);
}

/* DONO */
function ouvirPedidos(){
  db.collection("pedidos").onSnapshot(snap=>{
    pedidos.innerHTML="";
    snap.forEach(doc=>{
      const d = doc.data();
      if(!d.aprovado){
        pedidos.innerHTML += `
          <p>${doc.id}
          <button onclick="aprovar('${doc.id}')">Aceitar</button>
          <button onclick="recusar('${doc.id}')">Recusar</button>
          </p>`;
      }
    });
  });
}

function aprovar(nome){
  db.collection("pedidos").doc(nome).update({aprovado:true});
}

function recusar(nome){
  db.collection("pedidos").doc(nome).delete();
}

function ouvirResultados(){
  db.collection("resultados")
    .orderBy("data","desc")
    .onSnapshot(snap=>{
      resultados.innerHTML="";
      snap.forEach(doc=>{
        const r = doc.data();
        resultados.innerHTML += `<p>${r.nome} tirou ${r.numero}</p>`;
      });
    });
}
</script>

</body>
</html>
