<script>
const firebaseConfig = {
  apiKey: "SUA_API_KEY",
  authDomain: "SEU_DOMINIO",
  projectId: "SEU_PROJECT_ID",
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let userName = "";
let isAdmin = false;

function login(){
  const user = document.getElementById("name").value.trim();
  const pass = document.getElementById("password").value.trim();
  const role = document.getElementById("role").value;

  if(!user || !pass){
    alert("Preencha tudo");
    return;
  }

  if(pass !== "RC1"){
    alert("Senha incorreta");
    return;
  }

  userName = user;
  loginBox.style.display = "none";

  if(role === "admin"){
    isAdmin = true;
    adminBox.style.display = "block";
    loadRequests();
    loadResults();
  } else {
    userBox.style.display = "block";
    checkApproval();
  }
}

function requestRoll(){
  db.collection("requests").doc(userName).set({
    approved:false
  });
  alert("Pedido enviado ao dono");
}

function loadRequests(){
  db.collection("requests").onSnapshot(snap=>{
    requests.innerHTML="";
    snap.forEach(doc=>{
      const d = doc.data();
      if(!d.approved){
        requests.innerHTML += `
          <p>${doc.id}
          <button onclick="approve('${doc.id}')">Aceitar</button>
          <button onclick="reject('${doc.id}')">Recusar</button></p>
        `;
      }
    });
  });
}

function approve(name){
  db.collection("requests").doc(name).update({approved:true});
}

function reject(name){
  db.collection("requests").doc(name).delete();
}

function checkApproval(){
  db.collection("requests").doc(userName)
    .onSnapshot(doc=>{
      if(doc.exists && doc.data().approved){
        document.getElementById("rollBtn").disabled=false;
      }
    });
}

function roll(){
  const num = Math.floor(Math.random()*10)+1;
  document.getElementById("result").innerText = "VocÃª tirou: " + num;

  db.collection("results").add({
    name:userName,
    number:num,
    time: new Date()
  });
}

function loadResults(){
  db.collection("results").onSnapshot(snap=>{
    results.innerHTML="";
    snap.forEach(doc=>{
      const d = doc.data();
      results.innerHTML += `<p>${d.name} tirou ${d.number}</p>`;
    });
  });
}
</script>
