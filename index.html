<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Roleta Online</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body { background:#111; color:#eee; font-family:Arial; text-align:center }
.box { background:#1e1e1e; padding:20px; margin:20px auto; width:320px; border-radius:10px }
button, input, select { padding:10px; width:90%; margin:5px }
button { cursor:pointer }
</style>
</head>

<body>

<div class="box" id="loginBox">
  <h2>Login</h2>
  <input id="name" placeholder="Nome">
  <input id="password" type="password" placeholder="Senha">
  <select id="role">
    <option value="user">UsuÃ¡rio</option>
    <option value="admin">Dono</option>
  </select>
  <button onclick="login()">Entrar</button>
</div>

<div class="box" id="userBox" style="display:none">
  <h2>UsuÃ¡rio</h2>
  <button onclick="requestRoll()">Pedir acesso para rolar</button>
  <button onclick="roll()" id="rollBtn" disabled>ðŸŽ² Rolar</button>
  <p id="result"></p>
</div>

<div class="box" id="adminBox" style="display:none">
  <h2>Dono</h2>
  <h3>Pedidos</h3>
  <div id="requests"></div>
  <h3>Resultados</h3>
  <div id="results"></div>
</div>

<script>
// ðŸ”¥ CONFIGURE SEU FIREBASE AQUI
const firebaseConfig = {
  apiKey: "SUA_API_KEY",
  authDomain: "SEU_DOMINIO",
  projectId: "SEU_PROJECT_ID",
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let userName = "";

function login(){
  const name = name.value;
  const pass = password.value;
  const role = document.getElementById("role").value;

  if(pass !== "RC1"){
    alert("Senha incorreta");
    return;
  }

  userName = name;
  loginBox.style.display = "none";

  if(role === "admin"){
    adminBox.style.display = "block";
    loadRequests();
    loadResults();
  } else {
    userBox.style.display = "block";
    checkApproval();
  }
}

function requestRoll(){
  db.collection("requests").doc(userName).set({
    approved:false
  });
  alert("Pedido enviado ao dono");
}

function loadRequests(){
  db.collection("requests").onSnapshot(snap=>{
    requests.innerHTML="";
    snap.forEach(doc=>{
      const d = doc.data();
      if(!d.approved){
        requests.innerHTML += `
          <p>${doc.id}
          <button onclick="approve('${doc.id}')">Aceitar</button>
          <button onclick="reject('${doc.id}')">Recusar</button></p>
        `;
      }
    });
  });
}

function approve(name){
  db.collection("requests").doc(name).update({approved:true});
}

function reject(name){
  db.collection("requests").doc(name).delete();
}

function checkApproval(){
  db.collection("requests").doc(userName)
    .onSnapshot(doc=>{
      if(doc.exists && doc.data().approved){
        rollBtn.disabled=false;
      }
    });
}

function roll(){
  const num = Math.floor(Math.random()*10)+1;
  result.innerText = "VocÃª tirou: " + num;

  db.collection("results").add({
    name:userName,
    number:num,
    time: new Date()
  });
}

function loadResults(){
  db.collection("results").onSnapshot(snap=>{
    results.innerHTML="";
    snap.forEach(doc=>{
      const d = doc.data();
      results.innerHTML += `<p>${d.name} tirou ${d.number}</p>`;
    });
  });
}
</script>

</body>
</html>
