<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Roleta com Aprova√ß√£o</title>
<style>
body { background:#111; color:#eee; font-family:Arial; text-align:center }
.box { background:#1e1e1e; padding:20px; margin:20px auto; width:300px; border-radius:10px }
input, select, button { width:90%; padding:10px; margin:5px }
button { cursor:pointer }
</style>
</head>
<body>

<div class="box" id="loginBox">
  <h2>Login</h2>
  <input id="inpNome" placeholder="Nome">
  <input id="inpSenha" type="password" placeholder="Senha">
  <select id="inpTipo">
    <option value="user">Usu√°rio</option>
    <option value="admin">Dono</option>
  </select>
  <button onclick="entrar()">Entrar</button>
</div>

<div class="box" id="userBox" style="display:none">
  <h2>Usu√°rio</h2>
  <button onclick="pedirAcesso()">Pedir acesso</button>
  <button id="btnRolar" onclick="rolar()" disabled>üé≤ Rolar</button>
  <p id="resultado"></p>
</div>

<div class="box" id="adminBox" style="display:none">
  <h2>Dono</h2>

  <h3>Pedidos</h3>
  <div id="listaPedidos"></div>

  <h3>Resultados</h3>
  <div id="listaResultados"></div>
</div>

<script>
let usuarioAtual = "";

/* LOGIN */
function entrar(){
  const nome = inpNome.value.trim();
  const senha = inpSenha.value.trim();
  const tipo = inpTipo.value;

  if(!nome || !senha) return alert("Preencha tudo");
  if(senha !== "RC1") return alert("Senha incorreta");

  usuarioAtual = nome;
  loginBox.style.display = "none";

  if(tipo === "admin"){
    adminBox.style.display = "block";
    atualizarPedidos();
    atualizarResultados();
  } else {
    userBox.style.display = "block";
    verificarPermissao();
  }
}

/* USU√ÅRIO */
function pedirAcesso(){
  let pedidosDB = JSON.parse(localStorage.getItem("pedidosDB")) || {};
  pedidosDB[usuarioAtual] = false;
  localStorage.setItem("pedidosDB", JSON.stringify(pedidosDB));
  alert("Pedido enviado ao dono");
}

function verificarPermissao(){
  setInterval(() => {
    let pedidosDB = JSON.parse(localStorage.getItem("pedidosDB")) || {};
    if(pedidosDB[usuarioAtual] === true){
      btnRolar.disabled = false;
    }
  }, 500);
}

function rolar(){
  const n = Math.floor(Math.random()*10)+1;
  resultado.innerText = "Voc√™ tirou: " + n;

  let resultadosDB = JSON.parse(localStorage.getItem("resultadosDB")) || [];
  resultadosDB.push({nome:usuarioAtual, numero:n});
  localStorage.setItem("resultadosDB", JSON.stringify(resultadosDB));
}

/* DONO */
function atualizarPedidos(){
  setInterval(() => {
    let pedidosDB = JSON.parse(localStorage.getItem("pedidosDB")) || {};
    let html = "";

    for(let nome in pedidosDB){
      if(pedidosDB[nome] === false){
        html += `
          <p>${nome}
          <button onclick="aprovar('${nome}')">Aceitar</button>
          <button onclick="recusar('${nome}')">Recusar</button>
          </p>`;
      }
    }

    document.getElementById("listaPedidos").innerHTML = html || "<i>Nenhum pedido</i>";
  }, 500);
}

function aprovar(nome){
  let pedidosDB = JSON.parse(localStorage.getItem("pedidosDB"));
  pedidosDB[nome] = true;
  localStorage.setItem("pedidosDB", JSON.stringify(pedidosDB));
}

function recusar(nome){
  let pedidosDB = JSON.parse(localStorage.getItem("pedidosDB"));
  delete pedidosDB[nome];
  localStorage.setItem("pedidosDB", JSON.stringify(pedidosDB));
}

function atualizarResultados(){
  setInterval(() => {
    let resultadosDB = JSON.parse(localStorage.getItem("resultadosDB")) || [];
    let html = resultadosDB.map(r => `${r.nome} tirou ${r.numero}`).join("<br>");
    document.getElementById("listaResultados").innerHTML = html || "<i>Sem resultados</i>";
  }, 500);
}
</script>

</body>
</html>
